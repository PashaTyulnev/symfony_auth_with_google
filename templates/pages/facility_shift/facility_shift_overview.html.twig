<main class="max-w-[1800px] mx-auto px-6 py-8" data-controller="facility-shift">

    {# Split View Container #}
    <div class="grid grid-cols-12 gap-6 h-[calc(100vh-160px)]">

        {# Left Panel - Facilities List #}
        <div
            class="col-span-3 bg-white/60 dark:bg-gray-900/60 backdrop-blur-xl rounded-3xl border border-gray-200/50 dark:border-gray-800/50 overflow-hidden flex flex-col">
            <div class="p-4 border-b border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Objekte</h2>
                    <span
                        class="text-xs font-medium px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg text-gray-600 dark:text-gray-400">
                            {{ facilities|length }} Total
                        </span>
                </div>
                <div class="relative">
                    <input type="text"
                           placeholder="Objekt suchen..."
                           class="w-full pl-10 pr-4 py-2 bg-gray-100/80 dark:bg-gray-800/80 rounded-xl border-0 text-sm focus:ring-2 focus:ring-blue-500">
                    {{ ux_icon('lucide:search', { class: 'h-4 w-4 text-gray-400 absolute left-3 top-2.5' }) }}
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-2">
                <div class="space-y-1">
                    {% for facility in facilities %}
                        <button
                            data-facility-id="{{ facility.id }}"
                            class="facility-item w-full p-3 rounded-xl hover:bg-white/80 dark:hover:bg-gray-800/80 transition-all duration-200 text-left group {% if loop.first %}bg-white/80 dark:bg-gray-800/80 ring-2 ring-blue-500{% endif %}"
                            onclick="selectFacility({{ facility.id }})"
                        >
                            <div class="flex items-center gap-3">
                                <div
                                    class="p-2 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg">
                                    {{ ux_icon('lucide:building-2', { class: 'h-4 w-4 text-blue-600 dark:text-blue-400' }) }}
                                </div>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-900 dark:text-white">{{ facility.title }}</div>
                                    <div class="flex items-center gap-2 mt-0.5">
                                        <span
                                            class="text-xs font-medium px-1.5 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded">{{ facility.shortTitle }}</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">
                                                {% if facility.shifts is defined %}
                                                    {{ facility.shifts|length }} Schichten
                                                {% else %}
                                                    Keine Schichten
                                                {% endif %}
                                            </span>
                                    </div>
                                </div>
                                {{ ux_icon('lucide:chevron-right', { class: 'h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity' }) }}
                            </div>
                        </button>
                    {% endfor %}
                </div>
            </div>

            {# Add New Facility Button #}
            <div class="p-4 border-t border-gray-200/50 dark:border-gray-700/50">
                <button
                    class="w-full p-3 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-2 border-dashed border-blue-300 dark:border-blue-700 rounded-xl hover:border-blue-400 dark:hover:border-blue-600 transition-all duration-200 group">
                        <span class="flex items-center justify-center gap-2 text-blue-600 dark:text-blue-400">
                            {{ ux_icon('lucide:plus', { class: 'h-4 w-4' }) }}
                            <span class="text-sm font-medium">Neues Objekt</span>
                        </span>
                </button>
            </div>
        </div>

        {# Right Panel - Shifts Configuration #}
        <div
            class="col-span-9 bg-white/60 dark:bg-gray-900/60 backdrop-blur-xl rounded-3xl border border-gray-200/50 dark:border-gray-800/50 overflow-hidden flex flex-col">

            {% for facility in facilities %}
                <div id="facility-panel-{{ facility.id }}"
                     class="facility-panel flex flex-col h-full {% if not loop.first %}hidden{% endif %}">
                    {# Header #}
                    <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-2xl font-light text-gray-900 dark:text-white mb-2">{{ facility.title }}</h2>
                                <div class="flex items-center gap-4">
                                    <span class="text-sm text-gray-500 dark:text-gray-400">
                                        {{ ux_icon('lucide:map-pin', { class: 'h-4 w-4 inline mr-1' }) }}
                                        {{ facility.address.street ?? 'Keine Adresse' }}, {{ facility.address.zip ?? '' }} {{ facility.address.city ?? '' }}
                                    </span>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">
                                        {{ ux_icon('lucide:calendar', { class: 'h-4 w-4 inline mr-1' }) }}
                                        {% if facility.dateFrom %}{{ facility.dateFrom|date('d.m.Y') }}{% endif %}
                                        {% if facility.dateTo %} - {{ facility.dateTo|date('d.m.Y') }}{% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button
                                    class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl transition-all duration-200">
                                    {{ ux_icon('lucide:settings', { class: 'h-5 w-5 text-gray-600 dark:text-gray-400' }) }}
                                </button>
                            </div>
                        </div>
                    </div>

                    {# Shifts List #}
                    <div class="flex-1 overflow-y-auto p-6">
                        <div class="space-y-4">

                            {# Quick Templates #}
                            {#                            <div #}
                            {#                                class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/10 dark:to-indigo-900/10 rounded-2xl p-4 mb-6"> #}
                            {#                                <div class="flex items-center justify-between"> #}
                            {#                                    <span #}
                            {#                                        class="text-sm font-medium text-gray-700 dark:text-gray-300">Schnell-Vorlagen:</span> #}
                            {#                                    <div class="flex gap-2"> #}
                            {#                                        <button #}
                            {#                                            class="px-3 py-1.5 bg-white dark:bg-gray-800 rounded-lg text-xs font-medium hover:shadow-md transition-all duration-200"> #}
                            {#                                            {{ ux_icon('lucide:sunrise', { class: 'h-3.5 w-3.5 inline mr-1 text-amber-600' }) }} #}
                            {#                                            24/7 Vollbesetzung #}
                            {#                                        </button> #}
                            {#                                        <button #}
                            {#                                            class="px-3 py-1.5 bg-white dark:bg-gray-800 rounded-lg text-xs font-medium hover:shadow-md transition-all duration-200"> #}
                            {#                                            {{ ux_icon('lucide:sun', { class: 'h-3.5 w-3.5 inline mr-1 text-blue-600' }) }} #}
                            {#                                            Nur Tagschicht #}
                            {#                                        </button> #}
                            {#                                        <button #}
                            {#                                            class="px-3 py-1.5 bg-white dark:bg-gray-800 rounded-lg text-xs font-medium hover:shadow-md transition-all duration-200"> #}
                            {#                                            {{ ux_icon('lucide:moon', { class: 'h-3.5 w-3.5 inline mr-1 text-indigo-600' }) }} #}
                            {#                                            Nur Nachtschicht #}
                            {#                                        </button> #}
                            {#                                        <button #}
                            {#                                            class="px-3 py-1.5 bg-white dark:bg-gray-800 rounded-lg text-xs font-medium hover:shadow-md transition-all duration-200"> #}
                            {#                                            {{ ux_icon('lucide:calendar', { class: 'h-3.5 w-3.5 inline mr-1 text-purple-600' }) }} #}
                            {#                                            Wochenende #}
                            {#                                        </button> #}
                            {#                                    </div> #}
                            {#                                </div> #}
                            {#                            </div> #}

                            {# Shifts Table #}
                            <div class="bg-gray-50/50 dark:bg-gray-800/30 rounded-2xl overflow-hidden">
                                <div id="facility-shifts-container-{{ facility.id }}" class="space-y-3">
                                    {% for demandShift in facility.demandShifts %}
                                        {% include 'pages/facility_shift/facility_single_shift.html.twig' with {'demandShift':demandShift} %}
                                    {% endfor %}
                                </div>
                            </div>

                            {# Add New Shift Button #}
                            <button
                                data-action="click->facility-shift#createNewShiftElement"
                                data-facility-shift-facility-id-param="{{ facility.id }}"
                                data-facility-shift-facility-uri-param="{{ facility['@id'] }}"
                                class="w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-2xl hover:border-gray-400 dark:hover:border-gray-600 hover:bg-gray-50/50 dark:hover:bg-gray-800/30 transition-all duration-200 group">
                                <span
                                    class="flex items-center justify-center gap-2 text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300">
                                    {{ ux_icon('lucide:plus-circle', { class: 'h-5 w-5' }) }}
                                    <span class="text-sm font-medium">Neue Schicht hinzufügen</span>
                                </span>
                            </button>
                        </div>
                    </div>

                    {# Footer with Summary #}
                    <div
                        class="p-6 border-t border-gray-200/50 dark:border-gray-700/50 bg-gray-50/30 dark:bg-gray-800/30">
                        <div class="flex items-center justify-end">
                            {#                            <div class="flex items-center gap-6"> #}
                            {#                                <div> #}
                            {#                                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Wochenstunden</span> #}
                            {#                                    <div class="text-2xl font-bold text-gray-900 dark:text-white">168h</div> #}
                            {#                                </div> #}
                            {#                                <div> #}
                            {#                                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Min. Personal</span> #}
                            {#                                    <div class="text-2xl font-bold text-gray-900 dark:text-white">5</div> #}
                            {#                                </div> #}
                            {#                                <div> #}
                            {#                                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Geschätzte Kosten/Woche</span> #}
                            {#                                    <div class="text-2xl font-bold text-gray-900 dark:text-white">€6,720</div> #}
                            {#                                </div> #}
                            {#                            </div> #}
                            {#                            <button #}
                            {#                                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-xl font-medium transition-colors"> #}
                            {#                                {{ ux_icon('lucide:check', { class: 'h-4 w-4 inline mr-1' }) }} #}
                            {#                                Änderungen speichern #}
                            {#                            </button> #}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</main>
